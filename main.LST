C51 COMPILER V9.01   MAIN                                                                  02/25/2017 11:07:58 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\hex\main.obj
COMPILER INVOKED BY: D:\Keil_C51\C51\BIN\C51.EXE main.c BROWSE INCDIR(.\motor;.\trace;.\fireSensor) DEBUG OBJECTEXTEND O
                    -BJECT(.\hex\main.obj)

line level    source

   1          #include <reg52.h>
   2          #include "motor.h"
   3          #include "trace.h"
   4          #include "firesensor.h"
   5          
   6          #define NUM 0 
   7          #define ANGLE 2500
   8          int angle=0;
   9          bit pwmFlag=0;
  10          sbit beep=P2^3;
  11          sbit angleMotor=P1^2;
  12          uchar angleMotorCount=0;
  13          
  14          extern uint fireSensorAngle[5];
  15          extern char fireFlag;
  16          void delayms(uint xms)
  17          {
  18   1       uint i,j;
  19   1       for(i=xms;i>0;i--)
  20   1              for(j=110;j>0;j--);
  21   1      }
  22          
  23          void main(void)         
  24          {
  25   1              initWheelMotor();
  26   1              delayms(2);
  27   1              initAngleMotor();
  28   1              delayms(2);
  29   1              while(1)
  30   1              {
  31   2                      angle=checkFire();                      //传回度数
  32   2                      if(fireFlag<0)
  33   2                      {
  34   3                              /*关闭继电器*/
  35   3                              trace();                                //如果没有火焰就循迹
  36   3                      }
  37   2                      else                                            //有火焰就灭火
  38   2                      {
  39   3                              delayms(10);                    //防止误测
  40   3                              if(fireFlag);
  41   3                                      /*打开继电器*/  
  42   3                      }
  43   2              }
  44   1      }
  45          
  46          void Tim1forWheel(void) interrupt 3                             //两个轮子
  47          {
  48   1              EA=0;
  49   1              wheelMotorInterrupt();
  50   1              EA=1;
  51   1      }
  52          
  53          void Tim0forAngleMotor(void) interrupt 1
  54          {
C51 COMPILER V9.01   MAIN                                                                  02/25/2017 11:07:58 PAGE 2   

  55   1              TR0=0;
  56   1              TH0=(65536-100)/256;
  57   1              TL0=(65536-100)%256;
  58   1              if(angle>angleMotorCount)                                 //18,最左，3最右
  59   1              {
  60   2                       angleMotor=1;
  61   2              }       
  62   1              else
  63   1              {
  64   2                      angleMotor=0;
  65   2              }
  66   1              angleMotorCount++;
  67   1              if(angleMotorCount>=200)
  68   1              {
  69   2                      angleMotorCount=0;
  70   2              }
  71   1              TR0=1;
  72   1      }
  73          
  74          
  75                  /**弃用定时方案，因为定时器并不准确**/
  76          //      EA=0;
  77          //      if(pwmFlag)
  78          //      {
  79          //              pwmFlag=0;
  80          //              angleMotor=1;
  81          //              TH0=(65536-(fireSensorAngle[NUM]))/256;                 //高电平时间
  82          //              TL0=(65526-(fireSensorAngle[NUM]))%256;
  83          //              //angleMotorInterrupt(angle,pwmFlag);
  84          //              //beep=pwmFlag=0;
  85          //      }
  86          //      else
  87          //      {
  88          //              pwmFlag=1;
  89          //              angleMotor=0;
  90          //              TH0=(65536-(17220-fireSensorAngle[NUM]))/256;   //低电平时间
  91          //              TL0=(65536-(17220-fireSensorAngle[NUM]))%256;
  92          //              //angleMotorInterrupt(18349-angle,pwmFlag);                     //18349是20ms           
  93          //              //beep=pwmFlag=1;
  94          //      }
  95          //      EA=1;
  96          //}


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    202    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
